+++
date = "2016-04-26T21:24:18+03:00"
title = "Погружение в Акку"
description = "Что нужно знать об акторах?"
metakeywords = "Scala, actors, акторы, скала, архитектура, best practices, akka actors"
step = 1
author = "Александр Елисеев"
sidebarhistory = true
+++

Сегодня я решил погрузиться в акку. Я так и не сделал ни одного большого приложения на scala, поэтому мои знания о ней всё ещё достаточно поверхностны. Всё, что я могу рассказать, это своё видение акторов с точки зрения java-программиста. Поэтому мне нужно подчерпнуть информацию из книжек.

### Источник информации

Я полез искать источник информации, которому можно верить и на который можно ссылаться. Я пришёл к коллеге и спросил совета. Он сказал, что лучше официальных доков ничего не видел. Я собрал силы в кулак и скачал с сайта [akka.io](akka.io) 700 страниц документации для скалы. Мы вместе пробежались глазами по оглавлению и выясняли, что многое читать не обязательно.

Вооружившись официальными доками, я пошёл составлять список того, о чём нужно буду рассказывать.

[Читаем доки акки](http://akka.io/docs/).

### Моменты, о которых нужно рассказать

- В Scala преоблодает парадигма функционального программирования (это подтверждает [курс от создателя скалы](https://www.coursera.org/course/progfun)). Оно накладывает ограничение немутабельности на код. Это значит, что объекты не должны меняться. Если нужно изменить состояние объекта, нужно создать новый объект и использовать его.
- В реальной жизни, это ограничение слишком строгое. Реальные программы работают с данными, которые постоянно изменяются. Они зависят от внешних источников информации.
- Эта «реальность» несёт за собой много проблем. Из-за них появляется [большое количество ошибок](http://doc.akka.io/docs/akka/current/general/terminology.html#Deadlock_vs__Starvation_vs__Live-lock) в обычном низкоуровневом коде. Но этой реальности не избежать. Поэтому в функциональных языках программирования (эрланг, скала) был сделан шаг в сторону динамизации. Таким образом появились акторы.

#### Что такое актор?

- Актор — это абстракция, которую легче всего представить как «однопоточное» приложение, которое выполняет список задач. Однопоточность взята в кавычки, потому что актор не занимает поток JVM полностью и вообще, он может перемещаться между разными потоками. Подробнее можно узнать [в документации](http://doc.akka.io/docs/akka/current/general/actors.html).
- Это значит, что даже в однопоточном приложении могут одновременно существовать тысячи таких акторов.
- Ещё это значит, что актор может иметь изменяемое состояние, независимое от внешнего мира. И пользоваться им, не заботясь о проблемах, которые [обычно присущи многопоточным системам](http://doc.akka.io/docs/akka/current/general/terminology.html).
- Такой подход требует использование [лучших практик](http://doc.akka.io/docs/akka/current/general/actor-systems.html#Actor_Best_Practices). Если использовать акторы бездумно, не будет никакой пользы.

#### Особенности работы с акторами (выдержки из лучших практик)

- В основе акторов лежит философия «let it crash». Это значит, что не стоит писать обработку ошибок там же, где они возникают. Ошибки нужно обрабатывать на том уровне бизнес логики, на котором известно, что с ними делать. Это может быть реализовано с помощью [иерархической структуры акторов](http://doc.akka.io/docs/akka/current/general/actor-systems.html#Hierarchical_Structure).
- Блокирующие ресурсы (база данных, файлы на жёстком диске, синхронные http запросы и т.д.) требуют внимательного управления. Нельзя бездумно вызывать их в акторе (актор заблокируется и все запросы встанут в очередь), так же нельзя бездумно создавать футуры и исполнять запросы (их может стать слишком много и на сервере кончится память). Для этого есть [особые подходы](http://doc.akka.io/docs/akka/current/general/actor-systems.html#Blocking_Needs_Careful_Management).
- Изменяющееся состояние не должно выходить за рамки актора. Только немутабельные сообщения, не забываем, что это ФП. Не стоит забывать, что состояние можно передать случайно, если передавать в сообщении поведение (с помощью замыканий).
